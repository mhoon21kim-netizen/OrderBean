# OlderBean 구현 요구사항 목록

테스트 커버리지 보고서를 기반으로 구현해야 할 기능을 기능 요구사항과 비기능 요구사항으로 분류한 문서입니다.

---

## 📋 기능 요구사항 (Functional Requirements)

### 1. 인증 및 사용자 관리

#### 1.1 회원가입 기능
- **FR-AUTH-001**: 사용자 회원가입 API (`POST /api/auth/register`)
  - 이름, 이메일, 비밀번호, 역할(user/admin) 입력 받기
  - 이메일 중복 검증
  - 비밀번호 해싱 저장 (bcrypt)
  - JWT 토큰 생성 및 반환
  - 사용자 정보 반환 (비밀번호 제외)

#### 1.2 로그인 기능
- **FR-AUTH-002**: 사용자 로그인 API (`POST /api/auth/login`)
  - 이메일, 비밀번호로 인증
  - 비밀번호 검증
  - JWT 토큰 생성 및 반환
  - 사용자 정보 반환

#### 1.3 인증 미들웨어
- **FR-AUTH-003**: JWT 토큰 검증 미들웨어
  - Authorization 헤더에서 토큰 추출
  - 토큰 유효성 검증
  - 토큰 만료 검증
  - 사용자 정보 추출 및 요청 객체에 추가

---

### 2. 메뉴 관리 기능

#### 2.1 메뉴 조회
- **FR-MENU-001**: 메뉴 목록 조회 API (`GET /api/menus`)
  - 인증 불필요
  - 모든 메뉴 목록 반환
  - 메뉴 정보: id, name, price, description, image, created_at

- **FR-MENU-002**: 메뉴 상세 조회 API (`GET /api/menus/:id`)
  - 인증 불필요
  - 메뉴 ID로 상세 정보 조회
  - 옵션 정보 포함 (size, shot, syrup 등)
  - 존재하지 않는 메뉴 시 404 반환

#### 2.2 메뉴 생성 (관리자 전용)
- **FR-MENU-003**: 메뉴 생성 API (`POST /api/menus`)
  - 관리자 권한 필수
  - 메뉴명, 가격, 설명, 옵션 정보 입력
  - 메뉴명 중복 검증
  - 가격 유효성 검증 (양수만 허용)

#### 2.3 메뉴 수정 (관리자 전용)
- **FR-MENU-004**: 메뉴 수정 API (`PATCH /api/menus/:id`)
  - 관리자 권한 필수
  - 부분 수정 지원 (일부 필드만 업데이트 가능)
  - 존재하지 않는 메뉴 시 404 반환

#### 2.4 메뉴 삭제 (관리자 전용)
- **FR-MENU-005**: 메뉴 삭제 API (`DELETE /api/menus/:id`)
  - 관리자 권한 필수
  - 존재하지 않는 메뉴 시 404 반환
  - 삭제 후 조회 시 404 반환 확인

---

### 3. 주문 관리 기능

#### 3.1 주문 생성
- **FR-ORDER-001**: 주문 생성 API (`POST /api/orders`)
  - 인증 필수 (일반 사용자)
  - 주문 항목 배열 입력 (menu_id, quantity, options)
  - 여러 메뉴 동시 주문 지원
  - 주문 총액 자동 계산
  - 주문 상태 기본값: "접수"
  - 주문 항목 유효성 검증 (메뉴 존재 여부, 수량 > 0)

#### 3.2 주문 조회
- **FR-ORDER-002**: 주문 내역 조회 API (`GET /api/orders`)
  - 인증 필수
  - 본인 주문만 조회 (user_id 필터링)
  - 페이지네이션 지원 (limit, offset)
  - 최신순 정렬
  - 주문 정보: id, status, items, total_price, created_at

- **FR-ORDER-003**: 주문 상세 조회 API (`GET /api/orders/:id`)
  - 인증 필수
  - 본인 주문만 조회 가능 (권한 검증)
  - 존재하지 않는 주문 시 404 반환
  - 다른 사용자 주문 조회 시 403 반환

#### 3.3 주문 상태 관리 (관리자 전용)
- **FR-ORDER-004**: 주문 상태 업데이트 API (`PATCH /api/orders/:id/status`)
  - 관리자 권한 필수
  - 주문 상태 변경: "접수" → "제조중" → "완료" 또는 "취소"
  - 상태 값 유효성 검증
  - 존재하지 않는 주문 시 404 반환

---

### 4. 데이터 유효성 검증

#### 4.1 회원가입 유효성 검증
- **FR-VALID-001**: 이메일 형식 검증
  - 올바른 이메일 형식 검증
  - 잘못된 형식 시 400 에러

- **FR-VALID-002**: 비밀번호 길이 검증
  - 최소 길이 제한 (예: 6자 이상)
  - 짧은 비밀번호 시 400 에러

- **FR-VALID-003**: 필수 필드 검증
  - name, email, password 필수
  - 누락 시 400 에러

- **FR-VALID-004**: 이메일 중복 검증
  - 중복 이메일 시 400 에러

#### 4.2 메뉴 유효성 검증
- **FR-VALID-005**: 메뉴 필수 필드 검증
  - name, price 필수
  - 누락 시 400 에러

- **FR-VALID-006**: 가격 유효성 검증
  - 양수만 허용
  - 음수 시 400 에러

- **FR-VALID-007**: 메뉴명 중복 검증
  - 중복 메뉴명 시 400 에러

- **FR-VALID-008**: 메뉴 ID 형식 검증
  - 숫자 형식 검증
  - 잘못된 형식 시 400 에러

#### 4.3 주문 유효성 검증
- **FR-VALID-009**: 주문 항목 검증
  - items 배열 필수
  - 빈 배열 시 400 에러
  - menu_id, quantity 필수

- **FR-VALID-010**: 수량 유효성 검증
  - 수량 > 0 검증
  - 0 또는 음수 시 400 에러

- **FR-VALID-011**: 메뉴 존재 여부 검증
  - 존재하지 않는 menu_id 시 404 에러

- **FR-VALID-012**: 주문 상태 값 검증
  - 허용된 상태 값만: "접수", "제조중", "완료", "취소"
  - 잘못된 상태 값 시 400 에러

---

### 5. 권한 관리

#### 5.1 역할 기반 접근 제어 (RBAC)
- **FR-AUTH-004**: 관리자 권한 검증 미들웨어
  - 관리자(admin) 역할만 접근 허용
  - 일반 사용자(user) 접근 시 403 반환

- **FR-AUTH-005**: 사용자별 데이터 접근 제어
  - 주문 조회 시 본인 주문만 조회 가능
  - 다른 사용자 주문 조회 시 403 반환

---

### 6. 에러 처리

#### 6.1 HTTP 에러 응답
- **FR-ERROR-001**: 400 Bad Request 처리
  - 유효성 검증 실패
  - 잘못된 요청 형식

- **FR-ERROR-002**: 401 Unauthorized 처리
  - 토큰 없음
  - 토큰 만료
  - 잘못된 토큰

- **FR-ERROR-003**: 403 Forbidden 처리
  - 권한 없음
  - 다른 사용자 데이터 접근 시도

- **FR-ERROR-004**: 404 Not Found 처리
  - 존재하지 않는 리소스
  - 존재하지 않는 라우트

- **FR-ERROR-005**: 500 Internal Server Error 처리
  - 서버 내부 오류
  - 예상치 못한 에러

#### 6.2 에러 응답 형식
- **FR-ERROR-006**: 표준화된 에러 응답 형식
  ```json
  {
    "error": {
      "message": "에러 메시지",
      "code": "ERROR_CODE"
    }
  }
  ```

---

### 7. 기타 기능

#### 7.1 헬스 체크
- **FR-HEALTH-001**: 서버 상태 확인 API (`GET /api/health`)
  - 서버 실행 상태 확인
  - 응답: { status: "ok", message: "..." }

#### 7.2 404 핸들러
- **FR-ROUTE-001**: 존재하지 않는 라우트 처리
  - 모든 정의되지 않은 라우트에 대해 404 반환
  - 표준 에러 형식으로 응답

#### 7.3 페이지네이션
- **FR-PAGINATION-001**: 주문 내역 페이지네이션
  - limit 파라미터: 페이지당 항목 수 (기본값: 10)
  - offset 파라미터: 페이지 오프셋 (기본값: 0)

---

## 🔧 비기능 요구사항 (Non-Functional Requirements)

### 1. 보안 요구사항

#### 1.1 인증 및 인가
- **NFR-SEC-001**: JWT 토큰 기반 인증
  - 토큰 만료 시간 설정 (예: 24시간)
  - 토큰 서명 검증
  - 안전한 토큰 저장 (환경 변수)

- **NFR-SEC-002**: 비밀번호 보안
  - bcrypt를 사용한 비밀번호 해싱
  - 평문 비밀번호 저장 금지
  - 비밀번호 최소 길이 제한

- **NFR-SEC-003**: 권한 분리
  - 관리자와 일반 사용자 권한 명확히 분리
  - 역할 기반 접근 제어 (RBAC) 구현

- **NFR-SEC-004**: 입력 데이터 검증
  - SQL 인젝션 방지 (ORM 사용)
  - XSS 방지 (입력 데이터 검증)
  - CSRF 방지 (토큰 기반 인증)

#### 1.2 데이터 보호
- **NFR-SEC-005**: 민감 정보 보호
  - 비밀번호 응답에서 제외
  - 사용자 정보 최소화

---

### 2. 성능 요구사항

#### 2.1 응답 시간
- **NFR-PERF-001**: API 응답 시간
  - 동시 사용자 50명 기준 응답 시간 1초 이내
  - 데이터베이스 쿼리 최적화

#### 2.2 데이터베이스
- **NFR-PERF-002**: 데이터베이스 인덱싱
  - User 테이블: email 인덱스 (중복 검사 최적화)
  - Order 테이블: user_id 인덱스 (조회 최적화)
  - Menu 테이블: name 인덱스 (중복 검사 최적화)

#### 2.3 쿼리 최적화
- **NFR-PERF-003**: 효율적인 쿼리
  - N+1 문제 방지 (JOIN 사용)
  - 페이지네이션을 통한 대량 데이터 처리

---

### 3. 사용성 요구사항

#### 3.1 사용자 경험
- **NFR-USAB-001**: 모바일 대응
  - 반응형 웹 디자인
  - 모바일 환경 최적화

#### 3.2 에러 메시지
- **NFR-USAB-002**: 명확한 에러 메시지
  - 사용자 친화적인 에러 메시지
  - 에러 코드와 함께 상세 설명 제공

---

### 4. 유지보수성 요구사항

#### 4.1 코드 구조
- **NFR-MAIN-001**: 모듈화 구조
  - 컨트롤러, 서비스, 모델 계층 분리
  - 기능 단위 모듈화

#### 4.2 코드 품질
- **NFR-MAIN-002**: 코드 일관성
  - 코딩 컨벤션 준수
  - 주석 및 문서화

#### 4.3 테스트
- **NFR-MAIN-003**: 테스트 커버리지
  - 백엔드: 80% 이상 목표 (현재 100% 테스트 케이스 작성)
  - 프론트엔드: 70% 이상 목표

---

### 5. 확장성 요구사항

#### 5.1 데이터베이스 설계
- **NFR-SCAL-001**: 확장 가능한 스키마
  - 정규화된 데이터베이스 구조
  - 외래 키 제약 조건

#### 5.2 API 설계
- **NFR-SCAL-002**: RESTful API 설계
  - 표준 HTTP 메서드 사용
  - 일관된 URL 구조

---

### 6. 안정성 요구사항

#### 6.1 에러 처리
- **NFR-REL-001**: 견고한 에러 처리
  - 모든 예외 상황 처리
  - 예상치 못한 에러에 대한 기본 처리

#### 6.2 데이터 무결성
- **NFR-REL-002**: 데이터 검증
  - 데이터베이스 제약 조건
  - 애플리케이션 레벨 검증

---

### 7. 호환성 요구사항

#### 7.1 브라우저 호환성
- **NFR-COMP-001**: 최신 브라우저 지원
  - Chrome, Firefox, Safari, Edge 최신 버전

#### 7.2 API 호환성
- **NFR-COMP-002**: 표준 HTTP 프로토콜
  - RESTful API 원칙 준수
  - JSON 형식 데이터 교환

---

## 📊 우선순위별 구현 순서

### Phase 1: 핵심 기능 (필수)
1. 인증 시스템 (회원가입, 로그인, JWT)
2. 메뉴 조회 기능
3. 주문 생성 및 조회 기능
4. 기본 에러 처리

### Phase 2: 관리 기능 (중요)
5. 메뉴 관리 (CRUD) - 관리자
6. 주문 상태 관리 - 관리자
7. 권한 검증 미들웨어

### Phase 3: 고도화 (개선)
8. 유효성 검증 강화
9. 페이지네이션
10. 성능 최적화

---

## 📝 구현 체크리스트

### 백엔드 구현
- [ ] 데이터베이스 모델 (User, Menu, Order, OrderItem)
- [ ] 인증 라우트 및 컨트롤러
- [ ] 메뉴 라우트 및 컨트롤러
- [ ] 주문 라우트 및 컨트롤러
- [ ] 인증 미들웨어
- [ ] 권한 검증 미들웨어
- [ ] 유효성 검증 미들웨어
- [ ] 에러 핸들링 미들웨어
- [ ] 헬스 체크 엔드포인트
- [ ] 404 핸들러

### 프론트엔드 구현
- [ ] 인증 페이지 (로그인, 회원가입)
- [ ] 메뉴 조회 페이지
- [ ] 주문 생성 페이지
- [ ] 주문 내역 페이지
- [ ] 관리자 메뉴 관리 페이지
- [ ] 관리자 주문 관리 페이지
- [ ] API 서비스 레이어
- [ ] 인증 유틸리티

---

**마지막 업데이트:** 2024-12-16  
**기준 문서:** TEST_COVERAGE_REPORT.md

